<div class="wrapper">

  <h1>{{ isEditMode ? 'Edit IELTS Test' : 'Create IELTS Test' }}</h1>

  <!-- BASIC INFO -->
<div class="card">

  <div class="row">
    <input placeholder="Test Name" [(ngModel)]="test.name">
  </div>

  <div class="row">
    <input type="number" placeholder="Total Marks" [(ngModel)]="test.totalMarks">
    <input type="number" placeholder="Passing Marks" [(ngModel)]="test.passingMarks">
    <input type="number" placeholder="Duration (minutes)" [(ngModel)]="test.duration">
  </div>

  <select [(ngModel)]="test.type">
    <option value="">Select Test Type</option>
    <option value="LISTENING">Listening</option>
    <option value="READING">Reading</option>
    <option value="WRITING">Writing</option>
    <option value="SPEAKING">Speaking</option>
  </select>

</div>


  <!-- LISTENING -->
  <div *ngIf="test.type==='LISTENING'" class="card">
    <h2>Listening</h2>

    <div *ngFor="let rec of listening.recordings; let i=index" class="inner-card">
      <h3>Recording {{ i+1 }}</h3>
      <input placeholder="Audio URL" [(ngModel)]="rec.audio">

      <div *ngFor="let q of rec.questions; let qi=index" class="question">
        <input placeholder="Question" [(ngModel)]="q.q">
        <button class="delete-btn" (click)="removeQuestion(rec.questions, qi)">Delete</button>
      </div>

      <button class="add-btn" (click)="addQuestion(rec.questions)">
        Add More Question
      </button>
    </div>
  </div>

  <!-- READING -->
  <div *ngIf="test.type==='READING'" class="card">
    <h2>Reading</h2>

    <div *ngFor="let p of reading; let i=index" class="inner-card">
      <h3>Passage {{ i+1 }}</h3>
      <textarea placeholder="Passage text" [(ngModel)]="p.passage"></textarea>

      <div *ngFor="let q of p.questions; let qi=index" class="question">
        <input placeholder="Question" [(ngModel)]="q.q">
        <input placeholder="Answer" [(ngModel)]="q.answer">
        <button class="delete-btn" (click)="removeQuestion(p.questions, qi)">Delete</button>
      </div>

      <button class="add-btn" (click)="addQuestion(p.questions)">
        Add More Question
      </button>
    </div>
  </div>

  <!-- WRITING -->
  <div *ngIf="test.type==='WRITING'" class="card">
    <h2>Writing</h2>
    <textarea placeholder="Task 1" [(ngModel)]="writing.task1"></textarea>
    <textarea placeholder="Task 2" [(ngModel)]="writing.task2"></textarea>
  </div>

  <!-- SPEAKING -->
  <div *ngIf="test.type==='SPEAKING'" class="card">
    <h2>Speaking</h2>

    <h3>Part 1</h3>
    <div *ngFor="let q of speaking.part1; let i=index" class="question">
      <input placeholder="Question" [(ngModel)]="q.q">
      <button class="delete-btn" (click)="removeQuestion(speaking.part1, i)">Delete</button>
    </div>
    <button class="add-btn" (click)="addQuestion(speaking.part1)">Add More Question</button>

    <h3>Part 2</h3>
    <textarea placeholder="Cue Card Topic" [(ngModel)]="speaking.part2"></textarea>

    <h3>Part 3</h3>
    <div *ngFor="let q of speaking.part3; let i=index" class="question">
      <input placeholder="Question" [(ngModel)]="q.q">
      <button class="delete-btn" (click)="removeQuestion(speaking.part3, i)">Delete</button>
    </div>
    <button class="add-btn" (click)="addQuestion(speaking.part3)">Add More Question</button>
  </div>

  <!-- SAVE -->
  <button class="save-btn" [disabled]="!isFormComplete()" (click)="saveTest()">
    {{ isEditMode ? 'Update Test' : 'Save Test' }}
  </button>

  <!-- ALL TESTS -->
  <div class="card all-tests">
    <h2>All Tests</h2>

    <div *ngFor="let t of allTests" class="test-row">
      <span>{{ t.name }} ({{ t.type }})</span>

      <div class="actions">
        <button class="edit-btn" (click)="editTest(t.id)">Edit</button>
        <button class="delete-btn" (click)="deleteTest(t.id)">Delete</button>
      </div>
    </div>
  </div>

</div>
