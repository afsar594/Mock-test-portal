<div class="wrapper" *ngIf="test">

  <!-- Test Header -->
  <div class="test-header">
    <h1>{{ test.name }}</h1>
    <div class="info">
      <span><strong>Total Marks:</strong> {{ test.totalMarks }}</span>
      <span><strong>Passing Marks:</strong> {{ test.passingMarks }}</span>
      <span><strong>Time Left:</strong> {{ formatTime(timeLeft) }}</span>
    </div>
  </div>

  <!-- LISTENING -->
  <div *ngIf="test.type === 'LISTENING'">
    <div *ngFor="let rec of test.content.recordings; let i=index" class="card listening-card">
      <h3>ğŸ§ Recording {{ i + 1 }}</h3>

      <audio
        class="audio-player"
        [attr.id]="'audio'+i"
        (play)="onAudioPlay(i)"
        controls
        controlsList="nodownload noplaybackrate"
      >
        <source [src]="rec.audio" type="audio/mpeg">
      </audio>

      <p class="audio-timer">â± {{ audioTime[i] || 0 }}s</p>

      <div *ngFor="let q of rec.questions; let qi=index" class="listening-question">
        <p><strong>Q{{ qi + 1 }}.</strong> {{ q.q }}</p>
        <input [(ngModel)]="answers['l'+i+qi]" placeholder="Type your answer">
      </div>
    </div>
  </div>

  <!-- READING -->
  <div *ngIf="test.type === 'READING'">
    <div *ngFor="let p of test.content; let i=index" class="card">
      <h3>Passage {{ i + 1 }}</h3>
      <p>{{ p.passage }}</p>

      <div *ngFor="let q of p.questions; let qi=index">
        <p>{{ q.q }}</p>
        <input [(ngModel)]="answers['r'+i+qi]" placeholder="Your answer">
      </div>
    </div>
  </div>

  <!-- WRITING -->
  <div *ngIf="test.type === 'WRITING'" class="card">
    <h3>Task 1</h3>
    <p>{{ test.content.task1 }}</p>
    <textarea [(ngModel)]="answers.task1"></textarea>

    <h3>Task 2</h3>
    <p>{{ test.content.task2 }}</p>
    <textarea [(ngModel)]="answers.task2"></textarea>
  </div>

  <!-- SPEAKING -->
  <div *ngIf="test.type === 'SPEAKING'" class="card">
    <h3>ğŸ¤ Speaking Test</h3>

    <p *ngFor="let q of test.content.part1">{{ q.q }}</p>

    <button class="record-btn" (click)="startRecording()" [disabled]="recording">
      ğŸ™ Start Recording
    </button>
    <button class="stop-btn" (click)="stopRecording()" [disabled]="!recording">
      â¹ Stop Recording
    </button>

    <p *ngIf="recording" class="recording-time">Recording: {{ recordingTime }}s</p>

    <audio *ngIf="recordedAudio" [src]="recordedAudio" controls></audio>
  </div>

  <button class="submit" (click)="submitTest()" [disabled]="submitted">
    Submit Test
  </button>

  <div class="result" *ngIf="submitted">
    <h2>Test Submitted Successfully</h2>
    <p>The teacher will review your responses and respond as soon as possible.</p>
  </div>

</div>
